# è®¾å¤‡å­—æ®µåˆ†ç»„åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

ä¸ºè§£å†³è®¾å¤‡ç›‘æµ‹å­—æ®µè¿‡å¤šå¯¼è‡´å¡ç‰‡é«˜åº¦è¿‡å¤§çš„é—®é¢˜ï¼Œå®ç°å­—æ®µåˆ†ç»„æŠ˜å æ˜¾ç¤ºåŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… å­—æ®µåˆ†ç»„ç®¡ç†ï¼ˆcore/temperature/power/otherç­‰ï¼‰
- âœ… é»˜è®¤æ˜¾ç¤ºæ§åˆ¶ï¼ˆæ ¸å¿ƒå­—æ®µé»˜è®¤æ˜¾ç¤ºï¼Œå…¶ä»–æŠ˜å ï¼‰
- âœ… åˆ†ç»„æ’åºï¼ˆæ§åˆ¶åˆ†ç»„æ˜¾ç¤ºé¡ºåºï¼‰
- âœ… ä¸€é”®å±•å¼€/æ”¶èµ·æ‰€æœ‰åˆ†ç»„
- âœ… ç¾è§‚çš„åŠ¨ç”»æ•ˆæœ

---

## ğŸ¯ å®ç°æ•ˆæœ

### é»˜è®¤çŠ¶æ€ï¼ˆå¡ç‰‡é«˜åº¦çº¦300pxï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ­ EXT001 - 1å·æŒ¤å‡ºæœº       â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ ğŸŸ¢ è¿è¡Œä¸­                    â”‚
â”‚                              â”‚
â”‚ ğŸ“Š æ ¸å¿ƒå‚æ•° (4/11)          â”‚
â”‚ ğŸŒ¡ï¸ ç†”ä½“æ¸©åº¦: 285.6 Â°C      â”‚
â”‚ ğŸ“Š ç†”ä½“å‹åŠ›: 30.2 MPa       â”‚
â”‚ âš™ï¸ èºæ†è½¬é€Ÿ: 95.5 rpm       â”‚
â”‚ âš¡ ç”µæœºæ‰­çŸ©: 68.5 %         â”‚
â”‚                              â”‚
â”‚ â–¼ ğŸŒ¡ï¸ æ¸©åº¦å‚æ•° (5ä¸ª)        â”‚
â”‚ â–¼ ğŸ“‹ å…¶ä»–å‚æ•° (2ä¸ª)         â”‚
â”‚ [å±•å¼€å…¨éƒ¨]                   â”‚
â”‚                              â”‚
â”‚ ğŸ“ æŒ¤å‡ºè½¦é—´-AåŒº              â”‚
â”‚ [æŸ¥çœ‹å†å²] [åˆ†æè®¾å¤‡]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å±•å¼€çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ­ EXT001 - 1å·æŒ¤å‡ºæœº       â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ ğŸŸ¢ è¿è¡Œä¸­                    â”‚
â”‚                              â”‚
â”‚ ğŸ“Š æ ¸å¿ƒå‚æ•° (4/11)          â”‚
â”‚ ğŸŒ¡ï¸ ç†”ä½“æ¸©åº¦: 285.6 Â°C      â”‚
â”‚ ğŸ“Š ç†”ä½“å‹åŠ›: 30.2 MPa       â”‚
â”‚ âš™ï¸ èºæ†è½¬é€Ÿ: 95.5 rpm       â”‚
â”‚ âš¡ ç”µæœºæ‰­çŸ©: 68.5 %         â”‚
â”‚                              â”‚
â”‚ â–² ğŸŒ¡ï¸ æ¸©åº¦å‚æ•° (5ä¸ª)        â”‚
â”‚   ğŸŒ¡ï¸ 1åŒºæ¸©åº¦: 230.5 Â°C    â”‚
â”‚   ğŸŒ¡ï¸ 2åŒºæ¸©åº¦: 250.2 Â°C    â”‚
â”‚   ğŸŒ¡ï¸ 3åŒºæ¸©åº¦: 270.8 Â°C    â”‚
â”‚   ğŸŒ¡ï¸ 4åŒºæ¸©åº¦: 280.3 Â°C    â”‚
â”‚   ğŸŒ¡ï¸ 5åŒºæ¸©åº¦: 290.1 Â°C    â”‚
â”‚                              â”‚
â”‚ â–² ğŸ“‹ å…¶ä»–å‚æ•° (2ä¸ª)         â”‚
â”‚   âš¡ ä¸»ç”µæœºç”µæµ: 245.3 A    â”‚
â”‚   ğŸ“¦ å–‚æ–™é€Ÿåº¦: 1050.0 kg/h  â”‚
â”‚                              â”‚
â”‚ [æ”¶èµ·å…¨éƒ¨]                   â”‚
â”‚                              â”‚
â”‚ ğŸ“ æŒ¤å‡ºè½¦é—´-AåŒº              â”‚
â”‚ [æŸ¥çœ‹å†å²] [åˆ†æè®¾å¤‡]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»

```bash
# æ–¹å¼1ï¼šä½¿ç”¨psql
psql -U postgres -d devicemonitor -f database/migrations/device-field-grouping/001_add_field_grouping.sql

# æ–¹å¼2ï¼šä½¿ç”¨Pythonè„šæœ¬
python scripts/apply_field_grouping.py
```

### æ­¥éª¤2ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# é‡å¯åç«¯ä»¥åŠ è½½æ–°çš„Schema
python run.py
```

### æ­¥éª¤3ï¼šåˆ·æ–°å‰ç«¯

```bash
# å‰ç«¯ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ç»„ä»¶
# åˆ·æ–°æµè§ˆå™¨å³å¯çœ‹åˆ°æ•ˆæœ
```

---

## ğŸ“Š æ•°æ®åº“å˜æ›´

### æ–°å¢å­—æ®µ

| å­—æ®µå | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| field_group | VARCHAR(50) | 'default' | å­—æ®µåˆ†ç»„æ ‡è¯† |
| is_default_visible | BOOLEAN | true | æ˜¯å¦é»˜è®¤æ˜¾ç¤º |
| group_order | INT | 0 | åˆ†ç»„æ’åºé¡ºåº |

### æ–°å¢ç´¢å¼•

```sql
-- æå‡åˆ†ç»„æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_device_field_group 
ON t_device_field(device_type_code, field_group, is_default_visible);

CREATE INDEX idx_device_field_visible 
ON t_device_field(device_type_code, is_default_visible, sort_order);
```

---

## ğŸ¨ å­—æ®µåˆ†ç»„é…ç½®

### åˆ†ç»„ç±»å‹

| åˆ†ç»„ä»£ç  | åˆ†ç»„åç§° | å›¾æ ‡ | è¯´æ˜ |
|---------|---------|------|------|
| core | æ ¸å¿ƒå‚æ•° | ğŸ“Š | æœ€é‡è¦çš„å‚æ•°ï¼Œé»˜è®¤æ˜¾ç¤º |
| temperature | æ¸©åº¦å‚æ•° | ğŸŒ¡ï¸ | æ¸©åº¦ç›¸å…³å‚æ•° |
| power | åŠŸç‡å‚æ•° | âš¡ | åŠŸç‡ã€ç”µæµç›¸å…³å‚æ•° |
| speed | é€Ÿåº¦å‚æ•° | âš™ï¸ | é€Ÿåº¦ã€è½¬é€Ÿç›¸å…³å‚æ•° |
| dimension | å°ºå¯¸å‚æ•° | ğŸ“ | å°ºå¯¸ã€å®½åº¦ç›¸å…³å‚æ•° |
| other | å…¶ä»–å‚æ•° | ğŸ“‹ | å…¶ä»–æœªåˆ†ç±»å‚æ•° |

### é…ç½®åŸåˆ™

1. **æ ¸å¿ƒå­—æ®µ**: ä¸è¶…è¿‡4ä¸ªï¼Œé»˜è®¤æ˜¾ç¤º
2. **å…¶ä»–å­—æ®µ**: æŒ‰ç±»å‹åˆ†ç»„ï¼Œé»˜è®¤æŠ˜å 
3. **åˆ†ç»„æ’åº**: core(1) â†’ temperature(2) â†’ power(3) â†’ other(999)

---

## ğŸ“ é…ç½®ç¤ºä¾‹

### å¸ƒé²å…‹çº³æŒ¤å‡ºæœºé…ç½®

```sql
-- æ ¸å¿ƒå‚æ•°ï¼ˆ4ä¸ªï¼Œé»˜è®¤æ˜¾ç¤ºï¼‰
UPDATE t_device_field 
SET field_group = 'core',
    is_default_visible = true,
    group_order = 1
WHERE device_type_code = 'BRUCKNER_EXTRUDER' 
  AND field_code IN ('melt_temperature', 'melt_pressure', 'screw_speed', 'motor_torque');

-- æ¸©åº¦å‚æ•°ï¼ˆ5ä¸ªï¼Œé»˜è®¤æŠ˜å ï¼‰
UPDATE t_device_field 
SET field_group = 'temperature',
    is_default_visible = false,
    group_order = 2
WHERE device_type_code = 'BRUCKNER_EXTRUDER' 
  AND field_code IN ('zone1_temp', 'zone2_temp', 'zone3_temp', 'zone4_temp', 'zone5_temp');

-- å…¶ä»–å‚æ•°ï¼ˆ2ä¸ªï¼Œé»˜è®¤æŠ˜å ï¼‰
UPDATE t_device_field 
SET field_group = 'other',
    is_default_visible = false,
    group_order = 3
WHERE device_type_code = 'BRUCKNER_EXTRUDER' 
  AND field_code IN ('motor_current', 'feed_rate');
```

### è‡ªå®šä¹‰è®¾å¤‡é…ç½®

```sql
-- ä¸ºä½ çš„è®¾å¤‡ç±»å‹é…ç½®å­—æ®µåˆ†ç»„
UPDATE t_device_field 
SET field_group = 'core',           -- åˆ†ç»„ç±»å‹
    is_default_visible = true,      -- æ˜¯å¦é»˜è®¤æ˜¾ç¤º
    group_order = 1                 -- åˆ†ç»„æ’åº
WHERE device_type_code = 'YOUR_DEVICE_TYPE' 
  AND field_code IN ('field1', 'field2', 'field3', 'field4');
```

---

## ğŸ” éªŒè¯é…ç½®

### æŸ¥è¯¢å­—æ®µåˆ†ç»„ç»Ÿè®¡

```sql
SELECT 
    device_type_code,
    field_group,
    is_default_visible,
    COUNT(*) as field_count
FROM t_device_field
WHERE device_type_code = 'BRUCKNER_EXTRUDER'
  AND is_active = true
GROUP BY device_type_code, field_group, is_default_visible
ORDER BY group_order, is_default_visible DESC;
```

### æŸ¥çœ‹é»˜è®¤æ˜¾ç¤ºå­—æ®µ

```sql
SELECT 
    device_type_code,
    field_name,
    field_code,
    field_group,
    is_default_visible,
    sort_order
FROM t_device_field
WHERE device_type_code = 'BRUCKNER_EXTRUDER'
  AND is_active = true
ORDER BY is_default_visible DESC, sort_order;
```

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

```
database/migrations/device-field-grouping/
â”œâ”€â”€ 001_add_field_grouping.sql          # æ•°æ®åº“è¿ç§»è„šæœ¬
â””â”€â”€ README.md                            # æœ¬æ–‡ä»¶

web/src/components/device/
â”œâ”€â”€ DynamicMonitoringData.vue           # åŸç»„ä»¶ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ GroupedMonitoringData.vue           # æ–°åˆ†ç»„ç»„ä»¶

app/schemas/
â””â”€â”€ device_field.py                     # æ›´æ–°Schemaï¼ˆæ–°å¢3ä¸ªå­—æ®µï¼‰
```

---

## ğŸ¯ å·²é…ç½®è®¾å¤‡

### å¸ƒé²å…‹çº³è®¾å¤‡ï¼ˆ6ç§ï¼‰

| è®¾å¤‡ç±»å‹ | æ€»å­—æ®µ | é»˜è®¤æ˜¾ç¤º | æŠ˜å å­—æ®µ | çŠ¶æ€ |
|---------|--------|---------|---------|------|
| BRUCKNER_EXTRUDER | 11 | 4 | 7 | âœ… |
| BRUCKNER_DIE | 6 | 3 | 3 | âœ… |
| BRUCKNER_CHILL_ROLL | 7 | 4 | 3 | âœ… |
| BRUCKNER_MDO_STRETCH | 6 | 4 | 2 | âœ… |
| BRUCKNER_TDO_TENTER | 9 | 4 | 5 | âœ… |
| BRUCKNER_THICKNESS | 5 | 5 | 0 | âœ… |

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¸ºæ–°è®¾å¤‡ç±»å‹é…ç½®åˆ†ç»„

1. **ç¡®å®šæ ¸å¿ƒå­—æ®µ**ï¼ˆä¸è¶…è¿‡4ä¸ªï¼‰
2. **æŒ‰ç±»å‹åˆ†ç»„å…¶ä»–å­—æ®µ**
3. **æ‰§è¡ŒSQLé…ç½®**

```sql
-- ç¤ºä¾‹ï¼šé…ç½®æ–°è®¾å¤‡ç±»å‹
UPDATE t_device_field 
SET field_group = 'core',
    is_default_visible = true,
    group_order = 1
WHERE device_type_code = 'NEW_DEVICE_TYPE' 
  AND field_code IN ('key_field1', 'key_field2', 'key_field3', 'key_field4');
```

### è°ƒæ•´ç°æœ‰é…ç½®

```sql
-- å°†æŸä¸ªå­—æ®µæ”¹ä¸ºé»˜è®¤æ˜¾ç¤º
UPDATE t_device_field 
SET is_default_visible = true
WHERE device_type_code = 'DEVICE_TYPE' 
  AND field_code = 'field_code';

-- ä¿®æ”¹å­—æ®µåˆ†ç»„
UPDATE t_device_field 
SET field_group = 'temperature'
WHERE device_type_code = 'DEVICE_TYPE' 
  AND field_code = 'temp_field';
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç´¢å¼•ä¼˜åŒ–

å·²åˆ›å»ºçš„ç´¢å¼•å¯ä»¥æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼š

```sql
-- åˆ†ç»„æŸ¥è¯¢ç´¢å¼•
idx_device_field_group (device_type_code, field_group, is_default_visible)

-- å¯è§æ€§æŸ¥è¯¢ç´¢å¼•
idx_device_field_visible (device_type_code, is_default_visible, sort_order)
```

### æŸ¥è¯¢ä¼˜åŒ–

å‰ç«¯ç»„ä»¶ä¼šè‡ªåŠ¨ï¼š
- åªæŸ¥è¯¢æ¿€æ´»çš„å­—æ®µï¼ˆis_active = trueï¼‰
- æŒ‰åˆ†ç»„å’Œæ’åºåŠ è½½
- ä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜ç»“æœ

---

## âœ… é¢„æœŸæ•ˆæœ

å®æ–½åï¼š
- âœ… å¡ç‰‡é«˜åº¦ç»Ÿä¸€ï¼ˆçº¦300-350pxï¼‰
- âœ… ä¸€å±æ˜¾ç¤ºæ›´å¤šè®¾å¤‡ï¼ˆæå‡50%+ï¼‰
- âœ… æ ¸å¿ƒä¿¡æ¯çªå‡ºæ˜¾ç¤º
- âœ… è¯¦ç»†ä¿¡æ¯æŒ‰éœ€æŸ¥çœ‹
- âœ… ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå­—æ®µåˆ†ç»„ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**:
```sql
-- æŸ¥çœ‹å­—æ®µé…ç½®
SELECT field_code, field_group, is_default_visible 
FROM t_device_field 
WHERE device_type_code = 'YOUR_TYPE';
```

**è§£å†³**: ç¡®ä¿å·²æ‰§è¡Œè¿ç§»è„šæœ¬å¹¶é‡å¯åç«¯

### é—®é¢˜2ï¼šæ‰€æœ‰å­—æ®µéƒ½æ˜¾ç¤º

**æ£€æŸ¥**: ç¡®è®¤ `is_default_visible` å­—æ®µå€¼

**è§£å†³**:
```sql
UPDATE t_device_field 
SET is_default_visible = false
WHERE device_type_code = 'YOUR_TYPE' 
  AND field_code NOT IN ('core_field1', 'core_field2');
```

### é—®é¢˜3ï¼šåˆ†ç»„é¡ºåºä¸å¯¹

**æ£€æŸ¥**: æŸ¥çœ‹ `group_order` å€¼

**è§£å†³**:
```sql
UPDATE t_device_field 
SET group_order = 2
WHERE device_type_code = 'YOUR_TYPE' 
  AND field_group = 'temperature';
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼Œè¯·å‚è€ƒï¼š
- [è®¾å¤‡å¡ç‰‡å­—æ®µè¿‡å¤šä¼˜åŒ–æ–¹æ¡ˆ](../../docs/device_test/è®¾å¤‡å¡ç‰‡å­—æ®µè¿‡å¤šä¼˜åŒ–æ–¹æ¡ˆ.md)
- [è®¾å¤‡ç±»å‹åŠ¨æ€å‚æ•°å±•ç¤ºæ–¹æ¡ˆ](../../docs/device_test/è®¾å¤‡ç±»å‹åŠ¨æ€å‚æ•°å±•ç¤ºæ–¹æ¡ˆ.md)

---

**æœ€åæ›´æ–°**: 2025-11-25  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å·²å®æ–½
