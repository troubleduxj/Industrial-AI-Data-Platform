<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mockæ•°æ®æ§åˆ¶é¢æ¿</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .status-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 2px solid #e9ecef;
    }

    .status-card.enabled {
      background: #d4edda;
      border-color: #28a745;
    }

    .status-card.disabled {
      background: #f8d7da;
      border-color: #dc3545;
    }

    .status-title {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .enabled .status-icon {
      background: #28a745;
      color: white;
    }

    .disabled .status-icon {
      background: #dc3545;
      color: white;
    }

    .status-info {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }

    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    button {
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: #28a745;
      color: white;
    }

    .btn-primary:hover {
      background: #218838;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-info {
      background: #17a2b8;
      color: white;
    }

    .btn-info:hover {
      background: #138496;
    }

    .console-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      line-height: 1.6;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .console-output:empty::before {
      content: 'æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
      color: #666;
      font-style: italic;
    }

    .log-success {
      color: #4ec9b0;
    }

    .log-error {
      color: #f48771;
    }

    .log-info {
      color: #9cdcfe;
    }

    .log-warning {
      color: #dcdcaa;
    }

    .quick-links {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e9ecef;
    }

    .quick-link {
      padding: 8px 16px;
      background: #f8f9fa;
      border-radius: 6px;
      text-decoration: none;
      color: #495057;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .quick-link:hover {
      background: #e9ecef;
      color: #212529;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ­ Mockæ•°æ®æ§åˆ¶é¢æ¿</h1>
    <p class="subtitle">è®¾å¤‡ç›‘æ§ç³»ç»Ÿ - å‰ç«¯Mockæ•°æ®ç®¡ç†</p>

    <!-- çŠ¶æ€å¡ç‰‡ -->
    <div id="statusCard" class="status-card">
      <div class="status-title">
        <span class="status-icon" id="statusIcon">?</span>
        <span id="statusText">æ­£åœ¨æ£€æµ‹...</span>
      </div>
      <div class="status-info" id="statusInfo">
        æ­£åœ¨æ£€æŸ¥Mockæ¨¡å¼çŠ¶æ€...
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="button-group">
      <button class="btn-primary" onclick="enableMock()">âœ… å¯ç”¨Mockæ¨¡å¼</button>
      <button class="btn-danger" onclick="disableMock()">âŒ ç¦ç”¨Mockæ¨¡å¼</button>
      <button class="btn-info" onclick="reloadRules()">ğŸ”„ é‡æ–°åŠ è½½è§„åˆ™</button>
      <button class="btn-secondary" onclick="checkStatus()">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
    </div>

    <!-- æ§åˆ¶å°è¾“å‡º -->
    <h3 style="margin-bottom: 12px; color: #333;">ğŸ“‹ æ§åˆ¶å°è¾“å‡º</h3>
    <div id="consoleOutput" class="console-output"></div>

    <!-- å¿«æ·é“¾æ¥ -->
    <div class="quick-links">
      <a href="/" class="quick-link">ğŸ  è¿”å›ä¸»é¡µ</a>
      <a href="/#/advanced-settings/mock-data" class="quick-link">âš™ï¸ Mockç®¡ç†é¡µé¢</a>
      <a href="/#/device-monitor/monitor" class="quick-link">ğŸ“¡ å®æ—¶ç›‘æµ‹</a>
      <a href="/mock-diagnostic.html" class="quick-link">ğŸ” è¯Šæ–­å·¥å…·</a>
    </div>
  </div>

  <script>
    // æ—¥å¿—è¾“å‡ºåˆ°é¡µé¢
    function log(message, type = 'info') {
      const output = document.getElementById('consoleOutput')
      const timestamp = new Date().toLocaleTimeString()
      const colorClass = `log-${type}`
      output.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`
      output.scrollTop = output.scrollHeight
      console.log(message)
    }

    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatus(enabled, rulesCount = 0) {
      const card = document.getElementById('statusCard')
      const icon = document.getElementById('statusIcon')
      const text = document.getElementById('statusText')
      const info = document.getElementById('statusInfo')

      if (enabled) {
        card.className = 'status-card enabled'
        icon.textContent = 'âœ“'
        text.textContent = 'Mockæ¨¡å¼å·²å¯ç”¨'
        info.textContent = `å½“å‰å·²åŠ è½½ ${rulesCount} æ¡Mockè§„åˆ™ï¼ŒAPIè¯·æ±‚å°†è¢«æ‹¦æˆªå¹¶è¿”å›æ¨¡æ‹Ÿæ•°æ®ã€‚`
      } else {
        card.className = 'status-card disabled'
        icon.textContent = 'âœ—'
        text.textContent = 'Mockæ¨¡å¼å·²ç¦ç”¨'
        info.textContent = 'æ‰€æœ‰APIè¯·æ±‚å°†æ­£å¸¸å‘é€åˆ°åç«¯æœåŠ¡å™¨ã€‚'
      }
    }

    // å¯ç”¨Mockæ¨¡å¼
    async function enableMock() {
      try {
        log('æ­£åœ¨å¯ç”¨Mockæ¨¡å¼...', 'info')
        localStorage.setItem('mock_enabled', 'true')
        
        if (window.__mockInterceptor) {
          window.__mockInterceptor.enable()
          await window.__mockInterceptor.reload()
          const stats = window.__mockInterceptor.getStats()
          log(`âœ… Mockæ¨¡å¼å·²å¯ç”¨ï¼åŠ è½½äº† ${stats.rulesCount} æ¡è§„åˆ™`, 'success')
          updateStatus(true, stats.rulesCount)
        } else {
          log('âš ï¸ Mockæ‹¦æˆªå™¨æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢', 'warning')
          updateStatus(true, 0)
        }
      } catch (error) {
        log(`âŒ å¯ç”¨å¤±è´¥: ${error.message}`, 'error')
      }
    }

    // ç¦ç”¨Mockæ¨¡å¼
    function disableMock() {
      try {
        log('æ­£åœ¨ç¦ç”¨Mockæ¨¡å¼...', 'info')
        localStorage.setItem('mock_enabled', 'false')
        
        if (window.__mockInterceptor) {
          window.__mockInterceptor.disable()
          log('âœ… Mockæ¨¡å¼å·²ç¦ç”¨', 'success')
        } else {
          log('âœ… Mockæ¨¡å¼å·²ç¦ç”¨ï¼ˆæ‹¦æˆªå™¨æœªåˆå§‹åŒ–ï¼‰', 'success')
        }
        
        updateStatus(false, 0)
      } catch (error) {
        log(`âŒ ç¦ç”¨å¤±è´¥: ${error.message}`, 'error')
      }
    }

    // é‡æ–°åŠ è½½è§„åˆ™
    async function reloadRules() {
      try {
        log('æ­£åœ¨é‡æ–°åŠ è½½Mockè§„åˆ™...', 'info')
        
        if (window.__mockInterceptor) {
          const rules = await window.__mockInterceptor.reload()
          log(`âœ… å·²åŠ è½½ ${rules.length} æ¡Mockè§„åˆ™`, 'success')
          
          rules.forEach((rule, index) => {
            log(`  ${index + 1}. [${rule.method}] ${rule.name}`, 'info')
          })
          
          const stats = window.__mockInterceptor.getStats()
          updateStatus(stats.enabled, stats.rulesCount)
        } else {
          log('âŒ Mockæ‹¦æˆªå™¨æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°ä¸»åº”ç”¨', 'error')
        }
      } catch (error) {
        log(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error')
      }
    }

    // æ£€æŸ¥çŠ¶æ€
    async function checkStatus() {
      try {
        log('æ­£åœ¨æ£€æŸ¥MockçŠ¶æ€...', 'info')
        
        const localStorageState = localStorage.getItem('mock_enabled')
        log(`ğŸ“¦ localStorageçŠ¶æ€: ${localStorageState}`, 'info')
        
        if (window.__mockInterceptor) {
          const stats = window.__mockInterceptor.getStats()
          log(`ğŸ“Š Mockæ‹¦æˆªå™¨çŠ¶æ€:`, 'info')
          log(`  - å¯ç”¨çŠ¶æ€: ${stats.enabled}`, 'info')
          log(`  - è§„åˆ™æ•°é‡: ${stats.rulesCount}`, 'info')
          log(`  - å‘½ä¸­æ¬¡æ•°: ${stats.hitCount || 0}`, 'info')
          
          if (stats.rules && stats.rules.length > 0) {
            log(`ğŸ“‹ å·²åŠ è½½çš„è§„åˆ™:`, 'info')
            stats.rules.forEach((rule, index) => {
              log(`  ${index + 1}. [${rule.method}] ${rule.name} - ${rule.url_pattern}`, 'info')
            })
          }
          
          updateStatus(stats.enabled, stats.rulesCount)
        } else {
          log('âš ï¸ Mockæ‹¦æˆªå™¨æœªåœ¨ä¸»åº”ç”¨ä¸­åˆå§‹åŒ–', 'warning')
          log('ğŸ’¡ è¯·åœ¨ä¸»åº”ç”¨é¡µé¢ä¸­ä½¿ç”¨MockåŠŸèƒ½', 'warning')
          updateStatus(localStorageState === 'true', 0)
        }
        
        // æ£€æŸ¥åç«¯è¿æ¥
        log('æ­£åœ¨æ£€æŸ¥åç«¯è¿æ¥...', 'info')
        const response = await fetch('/api/v2/mock-data/active/list')
        const data = await response.json()
        log(`âœ… åç«¯è¿”å› ${data.data?.length || 0} æ¡å¯ç”¨çš„è§„åˆ™`, 'success')
        
      } catch (error) {
        log(`âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error')
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
    window.addEventListener('load', () => {
      log('ğŸ­ Mockæ§åˆ¶é¢æ¿å·²åŠ è½½', 'success')
      checkStatus()
    })
  </script>
</body>
</html>

