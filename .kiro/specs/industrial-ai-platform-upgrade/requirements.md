# 需求文档

## 项目介绍

本规范定义了将现有DeviceMonitorV4系统转型为综合性工业AI数据平台的需求。该转型将通过元数据驱动架构、先进AI能力和动态用户界面，使平台能够支持任何工业设备类型。

## 术语表

- **资产（Asset）**: 任何产生数据的工业设备或装置（替代"设备"）
- **资产类别（Asset_Category）**: 按类型和行业对资产进行分类（替代"设备类型"）
- **信号定义（Signal_Definition）**: 描述资产数据点的元数据（替代"设备字段"）
- **AI引擎（AI_Engine）**: 用于预测和分析的统一机器学习子系统
- **特征引擎（Feature_Engine）**: 自动化特征工程和计算系统
- **Schema管理器（Schema_Manager）**: 动态TDengine表结构管理系统
- **平台（Platform）**: 工业AI数据平台系统
- **遗留系统（Legacy_System）**: 现有的DeviceMonitorV4系统

## 需求

### 需求1：元数据驱动架构

**用户故事：** 作为平台管理员，我希望通过配置定义新的资产类型及其数据结构，以便在不修改代码的情况下接入任何工业设备。

#### 验收标准

1. 当管理员创建新资产类别时，平台应自动生成相应的TDengine超级表结构
2. 当管理员创建新资产类别时，平台应支持与已有超级表进行关联配置
3. 当向类别添加信号定义时，平台应更新TDengine超级表结构
4. 当创建资产时，平台应自动创建相应的TDengine子表
5. 平台应支持动态字段类型，包括float、int、bool、string、double和bigint
6. 当修改资产类别时，平台应在模式演进过程中保持数据完整性

### 需求2：统一AI引擎

**用户故事：** 作为数据科学家，我希望为任何资产类型部署和管理AI模型，以便为不同工业领域提供预测分析。

#### 验收标准

1. 当注册新AI模型时，AI引擎应存储模型元数据和配置
2. 当部署模型版本时，AI引擎应验证模型文件并更新注册表
3. 当激活模型版本时，AI引擎应将其加载到推理服务中
4. 当发出预测请求时，AI引擎应执行推理并持久化结果
5. AI引擎应支持多种算法类型，包括isolation_forest、arima和xgboost
6. 当更新模型时，AI引擎应维护预测历史和模型血缘关系

### 需求3：自动化特征工程

**用户故事：** 作为AI工程师，我希望使用配置定义特征计算，以便在不编写自定义代码的情况下创建派生指标。

#### 验收标准

1. 当创建特征定义时，特征引擎应解析JSON DSL配置
2. 当激活特征视图时，特征引擎应生成TDengine流计算SQL
3. 当流计算运行时，特征引擎应自动计算并存储特征
4. 特征引擎应支持聚合函数，包括avg、sum、max、min、count、stddev和percentile
5. 当监控特征质量时，特征引擎应报告完整性、新鲜度和分布指标

### 需求4：无缝数据迁移

**用户故事：** 作为系统管理员，我希望将现有设备数据迁移到新平台结构，以便在升级过程中保留历史数据。

#### 验收标准

1. 当启动迁移时，平台应将现有DeviceType记录映射到AssetCategory
2. 当迁移设备字段时，平台应将DeviceField记录转换为SignalDefinition
3. 当迁移设备实例时，平台应将DeviceInfo记录转换为Asset
4. 当启用双写模式时，平台应同时写入新旧模式
5. 当运行迁移验证时，平台应验证新旧结构之间的数据一致性

### 需求5：动态API接口

**用户故事：** 作为前端开发者，我希望使用适应不同资产类型的标准化API，以便构建适用于任何设备的通用界面。

#### 验收标准

1. 当发出API请求时，平台应返回标准化JSON格式的数据
2. 当查询资产类别时，平台应包含信号定义和元数据
3. 当请求实时数据时，平台应返回所有配置信号的最新值
4. 当请求预测时，平台应执行AI推理并返回结构化结果
5. 平台应提供遵循OpenAPI 3.0规范的RESTful端点

### 需求6：实时数据处理

**用户故事：** 作为运营经理，我希望实时监控资产性能，以便快速响应运营问题。

#### 验收标准

1. 当接收到资产数据时，平台应以亚秒级延迟将其存储在TDengine中
2. 当启用实时监控时，平台应在5秒内更新仪表板
3. 当流处理活跃时，平台应使用可配置的时间窗口计算特征
4. 当发生数据质量问题时，平台应在30秒内生成告警
5. 平台应支持来自多达10,000个资产的并发数据摄取

### 需求7：可扩展模型注册中心

**用户故事：** 作为MLOps工程师，我希望通过版本控制和部署控制管理模型生命周期，以确保可靠的AI运营。

#### 验收标准

1. 当注册模型时，平台应分配唯一标识符并跟踪元数据
2. 当创建模型版本时，平台应存储评估指标和部署状态
3. 当激活模型时，平台应确保每个模型只有一个生产版本
4. 当模型性能下降时，平台应支持回滚到以前的版本
5. 平台应维护所有模型生命周期操作的审计日志

### 需求8：配置驱动UI

**用户故事：** 作为最终用户，我希望界面自动适应不同的资产类型，以便使用一致的工作流程监控任何设备。

#### 验收标准

1. 当定义资产类别时，平台应生成适当的表单组件
2. 当信号定义包含显示配置时，平台应渲染自定义可视化
3. 当加载仪表板时，平台应基于信号元数据动态创建图表
4. 当添加新资产类型时，平台应自动将其包含在导航菜单中
5. 平台应支持桌面和移动设备的响应式设计

### 需求9：性能和可扩展性

**用户故事：** 作为系统架构师，我希望平台能够处理企业级部署，以便支持大型工业运营。

#### 验收标准

1. 当系统负载时，平台应为API调用保持亚秒级响应时间
2. 当数据量增加时，平台应使用TDengine集群进行水平扩展
3. 当并发用户访问系统时，平台应支持多达1,000个同时会话
4. 当查询历史数据时，平台应在10秒内返回1年范围的结果
5. 平台应在正常运营期间保持99.9%的正常运行时间

### 需求10：安全和访问控制

**用户故事：** 作为安全管理员，我希望控制对不同资产类型和数据的访问，以便维护数据隐私和运营安全。

#### 验收标准

1. 当用户认证时，平台应使用JWT令牌验证凭据
2. 当发出API请求时，平台应强制执行基于角色的访问控制
3. 当访问敏感数据时，平台应记录所有操作以供审计
4. 当传输数据时，平台应使用HTTPS加密
5. 平台应支持与企业身份提供商的集成