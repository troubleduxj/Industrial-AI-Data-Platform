# 需求文档 - 工业AI数据平台升级 V3

## 项目介绍

本规范定义了工业AI数据平台第三阶段升级的需求。基于V1（元数据驱动架构）和V2（AI闭环、实时推送）的基础，本阶段专注于**平台工程化、代码整合、遗留系统清理和企业级能力增强**，使平台真正成为通用的工业AI数据平台。

## 当前状态分析

### V1/V2已完成功能

| 模块 | 状态 | 说明 |
|------|------|------|
| 元数据驱动架构 | ✅ 完成 | AssetCategory、SignalDefinition、动态Schema |
| 统一AI引擎 | ✅ 完成 | 模型注册、版本管理、推理服务 |
| 特征工程 | ✅ 完成 | FeatureView、流计算、特征存储 |
| 决策引擎 | ✅ 完成 | 规则解析、运行时、动作执行、审计日志 |
| 模型存储 | ✅ 完成 | MinIO/本地存储、版本管理 |
| WebSocket推送 | ✅ 完成 | 实时数据、自动重连、订阅管理 |
| 数据采集层 | ✅ 完成 | MQTT/HTTP适配器、验证、重试 |
| 企业身份集成 | ✅ 完成 | LDAP/OAuth2提供商 |
| 前端实时监控 | ✅ 完成 | 图表更新、告警通知、预测显示 |

### 待解决问题

1. **遗留代码残留**: DeviceMonitorV2相关代码仍大量存在
2. **目录结构混乱**: platform_core、platform_v2、app三处存在重复逻辑
3. **命名不一致**: device/asset、field/signal混用
4. **前端遗留页面**: 旧监控页面与新平台页面并存
5. **API版本混乱**: v1/v2/v3三个版本API并存
6. **文档过时**: README仍为DeviceMonitorV2内容
7. **测试覆盖不足**: 集成测试和端到端测试缺失

## 术语表

- **平台核心（Platform_Core）**: 整合后的核心平台模块
- **遗留系统（Legacy_System）**: DeviceMonitorV2相关代码
- **统一API（Unified_API）**: 整合后的v4版本API
- **资产语义层（Asset_Semantic_Layer）**: 资产、信号、特征的统一抽象
- **智能计算层（Intelligence_Layer）**: AI引擎、决策引擎的统一抽象

## 需求

### 需求1：遗留代码清理与整合

**用户故事：** 作为开发者，我希望代码库清晰无冗余，以便快速理解和维护系统。

#### 验收标准

1. 当完成整合时，platform_v2目录应被移除，核心代码归并到platform_core
2. 当完成整合时，app/services中的重复服务应被清理
3. 当完成整合时，所有device相关命名应统一为asset
4. 当完成整合时，所有field相关命名应统一为signal
5. 平台应移除所有未使用的遗留表和模型
6. 平台应提供迁移脚本，支持从旧命名到新命名的自动转换

### 需求2：统一API版本（v4）

**用户故事：** 作为前端开发者，我希望使用单一版本的API，以便减少维护成本和认知负担。

#### 验收标准

1. 当创建v4 API时，平台应整合v2和v3的所有功能
2. 当v4 API发布时，平台应提供v2/v3到v4的兼容层
3. 当v4 API稳定后，平台应标记v1/v2/v3为废弃
4. v4 API应遵循RESTful最佳实践和OpenAPI 3.1规范
5. v4 API应提供统一的错误响应格式和分页规范
6. 平台应提供API版本迁移指南文档

### 需求3：前端遗留页面清理

**用户故事：** 作为最终用户，我希望界面风格统一，以便获得一致的使用体验。

#### 验收标准

1. 当完成清理时，所有DeviceMonitor相关页面应被移除或重构
2. 当完成清理时，导航菜单应只显示平台相关功能
3. 当完成清理时，所有页面应使用统一的组件库和样式
4. 平台应将旧页面代码归档到web/legacy目录
5. 平台应提供页面迁移映射文档

### 需求4：目录结构标准化

**用户故事：** 作为架构师，我希望代码按职责清晰分层，以便支持未来的微服务拆分。

#### 验收标准

1. 平台应采用以下标准目录结构：
   - platform_core/asset - 资产管理
   - platform_core/signal - 信号管理
   - platform_core/metadata - 元数据管理
   - platform_core/timeseries - 时序数据处理
   - platform_core/ingestion - 数据采集
   - ai_engine/model - 模型管理
   - ai_engine/inference - 推理服务
   - ai_engine/feature - 特征工程
   - ai_engine/decision - 决策引擎
2. 每个模块应有独立的__init__.py导出公共接口
3. 模块间依赖应单向，禁止循环依赖
4. 平台应提供模块依赖关系图

### 需求5：数据库Schema整合

**用户故事：** 作为DBA，我希望数据库表结构清晰规范，以便进行性能优化和维护。

#### 验收标准

1. 当完成整合时，所有device_*表应重命名为asset_*
2. 当完成整合时，所有field_*表应重命名为signal_*
3. 平台应提供数据库迁移脚本，支持无损迁移
4. 平台应清理所有未使用的遗留表
5. 平台应更新所有外键约束和索引
6. 平台应提供数据库ER图文档

### 需求6：测试体系完善

**用户故事：** 作为QA工程师，我希望有完整的测试覆盖，以便确保系统质量。

#### 验收标准

1. 平台应达到80%以上的单元测试覆盖率
2. 平台应提供核心流程的集成测试
3. 平台应提供端到端测试用例
4. 平台应配置CI/CD流水线自动运行测试
5. 平台应提供性能测试基准
6. 测试报告应自动生成并可视化

### 需求7：文档体系建设

**用户故事：** 作为新加入的开发者，我希望有完整的文档，以便快速上手项目。

#### 验收标准

1. README应更新为Industrial AI Data Platform的完整介绍
2. 平台应提供架构设计文档
3. 平台应提供API参考文档（自动生成）
4. 平台应提供部署运维文档
5. 平台应提供开发者指南
6. 平台应提供用户使用手册

### 需求8：可观测性增强

**用户故事：** 作为运维工程师，我希望能够监控系统运行状态，以便及时发现和解决问题。

#### 验收标准

1. 平台应集成Prometheus指标导出
2. 平台应提供Grafana监控仪表板模板
3. 平台应支持分布式链路追踪（OpenTelemetry）
4. 平台应提供结构化日志输出
5. 平台应支持告警规则配置
6. 平台应提供健康检查端点

### 需求9：多租户支持

**用户故事：** 作为SaaS运营者，我希望平台支持多租户隔离，以便为不同客户提供服务。

#### 验收标准

1. 平台应支持租户级别的数据隔离
2. 平台应支持租户级别的配置管理
3. 平台应支持租户级别的资源配额
4. 平台应支持租户级别的计费统计
5. 平台应支持租户管理API

### 需求10：插件化扩展机制

**用户故事：** 作为集成开发者，我希望能够通过插件扩展平台功能，以便满足特定行业需求。

#### 验收标准

1. 平台应定义标准的插件接口规范
2. 平台应支持数据采集适配器插件
3. 平台应支持AI算法插件
4. 平台应支持告警通知渠道插件
5. 平台应支持前端组件插件
6. 平台应提供插件开发SDK和文档

