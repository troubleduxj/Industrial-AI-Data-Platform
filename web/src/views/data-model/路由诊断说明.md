# æ•°æ®æ¨¡å‹ç®¡ç†èœå•ä¸æ˜¾ç¤ºé—®é¢˜è¯Šæ–­

## é—®é¢˜ç°è±¡
é€šè¿‡å‰ç«¯èœå•ç®¡ç†æ·»åŠ äº†"æ•°æ®æ¨¡å‹ç®¡ç†"èœå•ï¼Œä½†é¡µé¢ä¸Šçœ‹ä¸åˆ°ã€‚

## åŸå› åˆ†æ

### âœ… è·¯ç”±å·²è‡ªåŠ¨åŠ è½½
`web/src/views/data-model/route.js` ä¼šè¢«è‡ªåŠ¨æ‰«æåŠ è½½ï¼ˆé€šè¿‡ `import.meta.glob`ï¼‰ã€‚

### âš ï¸ å¯èƒ½çš„é—®é¢˜

#### 1. æ•°æ®åº“èœå•è·¯å¾„ä¸å‰ç«¯è·¯ç”±ä¸åŒ¹é…

**å‰ç«¯è·¯ç”±é…ç½®** (`route.js`):
- ä¸»è·¯å¾„: `/data-model`
- å­è·¯å¾„: `config`, `mapping`, `preview`

**æ•°æ®åº“èœå•**ï¼ˆç”¨æˆ·æ‰‹åŠ¨æ·»åŠ ï¼‰:
- å¯èƒ½ä½¿ç”¨äº†ä¸åŒçš„è·¯å¾„æ ¼å¼

#### 2. æƒé™æœªåˆ†é…
- èœå•å·²åˆ›å»ºï¼Œä½†æ²¡æœ‰åˆ†é…ç»™å½“å‰ç”¨æˆ·çš„è§’è‰²

#### 3. èœå•éšè—æˆ–é¡ºåºé—®é¢˜
- `is_visible` è®¾ç½®ä¸º false
- `sort_order` å¯¼è‡´èœå•ä½ç½®ä¸åˆç†

---

## ğŸ” è¯Šæ–­æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥æ•°æ®åº“èœå•é…ç½®

é€šè¿‡å‰ç«¯"ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†"ï¼Œæ£€æŸ¥ï¼š

- âœ… èœå•åç§°: `æ•°æ®æ¨¡å‹ç®¡ç†`
- âœ… èœå•è·¯å¾„: **å¿…é¡»æ˜¯** `/data-model`ï¼ˆä¸route.jsä¸€è‡´ï¼‰
- âœ… æ˜¯å¦å¯è§: å‹¾é€‰
- âœ… æ’åº: 50æˆ–å…¶ä»–åˆç†æ•°å€¼
- âœ… å›¾æ ‡: `database` æˆ– `icon-database`

**å­èœå•é…ç½®**:
| åç§° | è·¯å¾„ | çˆ¶èœå• |
|------|------|--------|
| æ¨¡å‹é…ç½®ç®¡ç† | `/data-model/config` | æ•°æ®æ¨¡å‹ç®¡ç† |
| å­—æ®µæ˜ å°„ç®¡ç† | `/data-model/mapping` | æ•°æ®æ¨¡å‹ç®¡ç† |
| é¢„è§ˆä¸æµ‹è¯• | `/data-model/preview` | æ•°æ®æ¨¡å‹ç®¡ç† |

### æ­¥éª¤2: æ£€æŸ¥è§’è‰²æƒé™

é€šè¿‡"ç³»ç»Ÿç®¡ç† â†’ è§’è‰²ç®¡ç†"ï¼Œç¡®ä¿ï¼š

- å½“å‰ç”¨æˆ·çš„è§’è‰²ï¼ˆå¦‚ adminï¼‰
- å·²å…³è”"æ•°æ®æ¨¡å‹ç®¡ç†"åŠå…¶å­èœå•

### æ­¥éª¤3: æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•

1. æŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. åœ¨ Console ä¸­æ‰§è¡Œï¼š

```javascript
// æ£€æŸ¥å·²åŠ è½½çš„è·¯ç”±
const router = window.$router
console.log('æ‰€æœ‰è·¯ç”±:', router.getRoutes())

// æŸ¥æ‰¾æ•°æ®æ¨¡å‹è·¯ç”±
const dataModelRoute = router.getRoutes().find(r => r.path === '/data-model')
console.log('æ•°æ®æ¨¡å‹è·¯ç”±:', dataModelRoute)

// æ£€æŸ¥ç”¨æˆ·èœå•
const userStore = window.$userStore || window.$pinia.state.value.user
console.log('ç”¨æˆ·èœå•:', userStore?.menus)
```

### æ­¥éª¤4: åˆ·æ–°åŠ¨æ€è·¯ç”±

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// åˆ·æ–°è·¯ç”±
const permissionStore = window.$pinia?.state.value.permission
if (permissionStore) {
  await permissionStore.generateRoutes()
  console.log('è·¯ç”±å·²åˆ·æ–°')
}

// æˆ–è€…ç›´æ¥é‡æ–°ç™»å½•
```

---

## ğŸš€ å¿«é€Ÿè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä½¿ç”¨æ•°æ®åº“è„šæœ¬ï¼ˆæ¨èï¼‰â­

**åˆ é™¤æ‰‹åŠ¨åˆ›å»ºçš„èœå•**ï¼Œç„¶åè¿è¡Œè„šæœ¬ï¼š

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•
python database/migrations/device-data-model/execute_menu_migration.py
```

è¿™ä¼šåˆ›å»ºæ­£ç¡®æ ¼å¼çš„èœå•é¡¹ã€‚

### æ–¹æ¡ˆ2: æ‰‹åŠ¨ä¿®æ­£èœå•é…ç½®

åœ¨"ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†"ï¼š

1. **æ£€æŸ¥æ ¹èœå•**
   - åç§°: `æ•°æ®æ¨¡å‹ç®¡ç†`
   - è·¯å¾„: `/data-model` âš ï¸ï¼ˆå¿…é¡»å®Œå…¨åŒ¹é…ï¼‰
   - çˆ¶èœå•: æ— ï¼ˆæ ¹èœå•ï¼‰
   - æ˜¯å¦å¯è§: âœ…
   - å›¾æ ‡: `database`
   - æ’åº: `50`

2. **æ£€æŸ¥å­èœå•**ï¼ˆ3ä¸ªï¼‰
   - çˆ¶èœå•: é€‰æ‹©"æ•°æ®æ¨¡å‹ç®¡ç†"
   - è·¯å¾„æ ¼å¼: `/data-model/config`ï¼ˆå®Œæ•´è·¯å¾„ï¼‰
   - æ˜¯å¦å¯è§: âœ…

3. **åˆ†é…æƒé™**
   - ç³»ç»Ÿç®¡ç† â†’ è§’è‰²ç®¡ç†
   - é€‰æ‹© admin è§’è‰²
   - å‹¾é€‰"æ•°æ®æ¨¡å‹ç®¡ç†"åŠå…¶æ‰€æœ‰å­èœå•
   - ä¿å­˜

### æ–¹æ¡ˆ3: é‡æ–°ç™»å½•

èœå•æƒé™å¯èƒ½éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆï¼š

1. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ
2. é€€å‡ºç™»å½•
3. é‡æ–°ç™»å½•
4. æ£€æŸ¥èœå•

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### 1. èœå•æ˜¾ç¤ºéªŒè¯
å·¦ä¾§èœå•æ åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ“Š æ•°æ®æ¨¡å‹ç®¡ç†
   â”œâ”€ âš™ï¸ æ¨¡å‹é…ç½®ç®¡ç†
   â”œâ”€ ğŸ”— å­—æ®µæ˜ å°„ç®¡ç†
   â””â”€ ğŸ‘ï¸ é¢„è§ˆä¸æµ‹è¯•
```

### 2. è·¯ç”±è·³è½¬éªŒè¯
ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š
- http://localhost:3001/data-model/config
- http://localhost:3001/data-model/mapping
- http://localhost:3001/data-model/preview

å¦‚æœå¯ä»¥è®¿é—®ï¼Œè¯´æ˜è·¯ç”±æ­£å¸¸ï¼Œé—®é¢˜åœ¨èœå•é…ç½®ã€‚

### 3. æƒé™éªŒè¯
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
const permissionStore = window.$pinia?.state.value.permission
console.log('APIæƒé™:', permissionStore?.accessApis)
console.log('è·¯ç”±æƒé™:', permissionStore?.accessRoutes)
```

---

## ğŸ“‹ å¸¸è§é”™è¯¯å¯¹æ¯”

| é”™è¯¯é…ç½® | æ­£ç¡®é…ç½® | è¯´æ˜ |
|---------|---------|------|
| `/data-model/` | `/data-model` | ç»“å°¾ä¸è¦æ–œæ  |
| `data-model` | `/data-model` | å¿…é¡»ä»¥ `/` å¼€å¤´ |
| `/dataModel` | `/data-model` | è·¯å¾„åŒºåˆ†å¤§å°å†™ |
| `config` | `/data-model/config` | å­èœå•ä½¿ç”¨å®Œæ•´è·¯å¾„ |

---

## âœ… æ¨èæ“ä½œæµç¨‹

1. **åˆ é™¤æ‰‹åŠ¨åˆ›å»ºçš„èœå•** âŒ
   - ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†
   - åˆ é™¤"æ•°æ®æ¨¡å‹ç®¡ç†"åŠå…¶å­èœå•

2. **æ‰§è¡Œæ•°æ®åº“è„šæœ¬** âœ…
   ```powershell
   python database/migrations/device-data-model/execute_menu_migration.py
   ```

3. **é‡æ–°ç™»å½•** ğŸ”„
   - é€€å‡ºå½“å‰ç™»å½•
   - é‡æ–°ç™»å½•ç³»ç»Ÿ

4. **éªŒè¯èœå•** âœ…
   - æŸ¥çœ‹å·¦ä¾§èœå•æ 
   - ç‚¹å‡»å„ä¸ªå­èœå•æµ‹è¯•

---

## ğŸ“ è°ƒè¯•è¾“å‡º

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º**:
   ```javascript
   console.log('è·¯ç”±:', router.getRoutes().filter(r => r.path.includes('data-model')))
   console.log('èœå•:', userStore?.menus)
   ```

2. **æ•°æ®åº“èœå•æŸ¥è¯¢**:
   ```sql
   SELECT id, parent_id, name, path, is_visible, sort_order 
   FROM t_menu 
   WHERE path LIKE '%data-model%' 
   OR name LIKE '%æ•°æ®æ¨¡å‹%';
   ```

3. **æƒé™æŸ¥è¯¢**:
   ```sql
   SELECT m.name, m.path, r.role_name 
   FROM t_menu m
   JOIN t_role_menu rm ON m.id = rm.menu_id
   JOIN t_role r ON rm.role_id = r.id
   WHERE m.path LIKE '%data-model%';
   ```

---

**æœ€å¿«çš„è§£å†³æ–¹æ¡ˆ**: åˆ é™¤æ‰‹åŠ¨èœå• â†’ æ‰§è¡Œè„šæœ¬ â†’ é‡æ–°ç™»å½•ï¼ ğŸš€

